<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>HashHero AMA</title>
  <style>
    body { font-family: system-ui, Arial, sans-serif; margin: 0; background:#0f1220; color:#e5e7eb; }
    .wrap { max-width: 720px; margin: 40px auto; padding: 16px; }
    h1 { font-size: 28px; margin: 0 0 16px; }
    .row { display:flex; gap:8px; }
    input { flex:1; padding:10px 12px; border-radius:8px; border:1px solid #2a2f45; background:#0b0e1a; color:#e5e7eb; }
    button { padding:10px 14px; border-radius:8px; border:none; background:#6366f1; color:white; cursor:pointer; }
    button:disabled { opacity:.6; cursor:not-allowed; }
    .card { margin-top:14px; padding:12px; background:#0b0e1a; border:1px solid #2a2f45; border-radius:10px; white-space:pre-wrap; }
    .err { color:#fca5a5; font-size:14px; margin-top:8px; }
    .muted { color:#9aa0b4; font-size:14px; }
    .tip { margin-top:8px; color:#9aa0b4; font-size:13px; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>HashHero AMA</h1>
    <div class="row">
      <input id="q" placeholder="Ask me anything…" />
      <button id="ask">Ask</button>
      <button id="health" style="background:#374151">Health</button>
    </div>
    <div id="err" class="err" style="display:none;"></div>
    <div id="out" class="card" style="display:none;"></div>
    <p class="tip">Tip: start with <em>HASHHERO_MOCK=1</em> in Vercel env to verify wiring, then set to 0 to go live.</p>
    <p class="muted">Powered by <code>/api/ask</code></p>
  </div>

  <script>
    const $q = document.getElementById('q');
    const $ask = document.getElementById('ask');
    const $health = document.getElementById('health');
    const $out = document.getElementById('out');
    const $err = document.getElementById('err');

    async function ask() {
      $ask.disabled = true; $err.style.display = 'none'; $out.style.display = 'none';
      try {
        const r = await fetch('/api/ask', {
          method: 'POST',
          headers: {'content-type':'application/json'},
          body: JSON.stringify({ question: $q.value.trim() })
        });
        if (!r.ok) throw new Error(await r.text());
        const text = await r.text();
        $out.textContent = text; $out.style.display = 'block';
      } catch (e) {
        $err.textContent = 'Error: ' + (e.message || e); $err.style.display = 'block';
      } finally {
        $ask.disabled = false;
      }
    }
    async function health() {
      try {
        const r = await fetch('/api/ask', { method:'POST', headers: {'x-hashhero-health':'ping'} });
        alert(r.ok ? 'API is up ✅' : `API down ❌ (${r.status})`);
      } catch { alert('API down ❌'); }
    }
    $ask.onclick = ask; $health.onclick = health;
    $q.addEventListener('keydown', e => (e.key === 'Enter') && ask());
  </script>
</body>
</html>
