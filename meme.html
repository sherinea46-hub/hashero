
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <meta name="theme-color" content="#0f1220" />
  <title>Meme — HashHero</title>
  <link rel="stylesheet" href="assets/css/site.css" />

  <!-- Primary SEO -->
  <title>Meme Generator — Free tool for creators | HashHero</title>
  <meta name="description" content="Create memes fast: upload or pick a template, add draggable text, and export PNG/JPG. Free, no login." />
  <link rel="canonical" href="https://hashhero.app/meme" />

  <!-- Open Graph -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Meme Generator — Free tool for creators" />
  <meta property="og:description" content="Upload or choose a template, add text, and download your meme in seconds." />
  <meta property="og:url" content="https://hashhero.app/meme" />
  <meta property="og:image" content="https://hashhero.app/assets/og/hashhero-og.jpg" />

  <!-- Twitter Cards -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Meme Generator — Free tool for creators" />
  <meta name="twitter:description" content="Upload or choose a template, add text, and download your meme in seconds." />
  <meta name="twitter:image" content="https://hashhero.app/assets/og/hashhero-og.jpg" />

  <!-- Favicons -->
  <link rel="icon" type="image/svg+xml" href="/assets/icons/favicon.svg" />
  <link rel="apple-touch-icon" href="/assets/icons/apple-touch-icon.png" />
  <link rel="manifest" href="/site.webmanifest" />

  <style>
    /* Minimal page-specific tweaks; main look comes from site.css */
    .meme-grid { display: grid; grid-template-columns: 380px 1fr; gap: 16px; }
    .meme-tools .row { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .template-grid { display:grid; grid-template-columns: repeat(3, 1fr); gap:10px; }
    .template { border:1px solid rgba(255,255,255,0.08); border-radius:12px; overflow:hidden; background: rgba(255,255,255,0.03); cursor:pointer; }
    .template img { display:block; width:100%; height:100%; object-fit:cover; aspect-ratio: 1 / 1; }
    canvas { width:100%; background:#000; border-radius: 14px; border:1px solid rgba(255,255,255,0.08); }

    .pill, .btn-secondary {
      display:inline-flex; align-items:center; gap:6px;
      padding:8px 12px; border-radius:12px;
      background: rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.12);
      color: inherit; text-decoration: none; cursor: pointer; font-size: 14px;
    }
    .small { font-size:12px; }
    .status { font-size:12px; color:#ffb4b4; min-height:1.2em; }

    /* Mobile optimizations */
    @media (max-width: 980px) {
      .meme-grid { grid-template-columns: 1fr; }
      .template-grid { grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 520px) {
      .template-grid { grid-template-columns: 1fr 1fr; gap:8px; }
      .pill, .btn-secondary { padding:8px 10px; font-size:13px; }
      input[type="file"], input[type="text"], select { width: 100%; }
    }
  </style>
</head>
<body>
  <header class="hh-header">
    <a class="hh-brand" href="index.html"><span class="hh-dot">H</span><span>HashHero</span></a>
    <nav class="hh-nav">
      <a class="hh-link" href="index.html#generator">Generator</a>
      <a class="hh-link askai" href="index.html#ama">Ask AI</a>
      <a class="hh-link" href="index.html#qr">QR Codes</a>
      <a class="hh-link" href="index.html#timer">Timer</a>
      <a class="hh-link" href="index.html#audio">Audio</a>
      <a class="hh-link hh-link--primary" href="meme.html">Meme</a>
      <a class="hh-link" href="about.html">About</a>
    </nav>
  </header>

  <main class="hh-main">
    <section class="hh-section">
      <div class="card highlight meme-tools">
        <h1>Meme Generator</h1>
        <p class="muted">Upload an image or pick a template. Add draggable text and download.</p>

        <div class="meme-grid">
          <!-- Tools -->
          <div>
            <div class="row">
              <label for="file" class="small muted">Upload image</label>
              <input id="file" type="file" accept="image/*">
            </div>

            <div class="row" style="justify-content:space-between; margin-top:10px;">
              <div class="row">
                <button class="pill" id="tabBuiltIn">Built-in</button>
                <button class="pill" id="tabTrending">Trending</button>
              </div>
              <div class="row">
                <input id="tplSearch" type="text" placeholder="Search templates… (e.g., drake, distracted)" style="min-width:220px;">
                <button class="pill" id="clearTemplate">Clear</button>
              </div>
            </div>

            <div class="template-grid" id="templates" style="margin-top:10px;"></div>
            <p class="small muted">Built-in templates work offline. <strong>Trending</strong> pulls popular templates from Imgflip. If a template image can’t load due to CORS, tap “Open”, download it, then upload.</p>

            <hr>

            <div class="row">
              <button class="btn-secondary" id="addText">+ Add text</button>
              <button class="btn-secondary" id="resetPositions">Reset positions</button>
              <label class="small muted" style="display:inline-flex; align-items:center; gap:6px;">
                <input type="checkbox" id="upper" checked> UPPERCASE
              </label>
            </div>

            <div class="row" style="margin-top:10px;">
              <label class="small muted" style="min-width:90px;">Font size</label>
              <input id="fontSize" type="range" min="10" max="120" value="48" style="flex:1;">
            </div>
            <div class="row">
              <label class="small muted" style="min-width:90px;">Outline</label>
              <input id="outline" type="range" min="0" max="12" value="6" style="flex:1;">
            </div>
            <div class="row">
              <label class="small muted" style="min-width:90px;">Align</label>
              <select id="align">
                <option value="center">Center</option>
                <option value="left">Left</option>
                <option value="right">Right</option>
              </select>
            </div>

            <div class="row" style="margin-top:10px;">
              <input id="watermarkText" type="text" placeholder="Watermark (optional, e.g., hashhero)" style="flex:1;">
              <label class="small muted" style="display:inline-flex; align-items:center; gap:6px;">
                <input type="checkbox" id="wm"> Enable watermark
              </label>
            </div>

            <hr>
            <div class="row">
              <button class="btn">Download PNG</button>
              <button class="btn" id="downloadJpg">Download JPG</button>
            </div>

            <div id="status" class="status" aria-live="polite"></div>

            <div id="textList" style="margin-top:14px;"></div>
          </div>

          <!-- Canvas -->
          <div class="card">
            <canvas id="c" width="1000" height="1000" aria-label="Meme preview canvas"></canvas>
          </div>
        </div>
      </div>
    </section>

    <section class="hh-section">
      <div class="card">
        <strong>Disclaimer:</strong>
        <p class="small muted" style="margin-top:6px;">
          Some tools may surface third-party content (e.g., meme templates). Please ensure you have the right to use any images, audio, or text you publish.
          HashHero provides tools only; usage is your responsibility.
        </p>
      </div>
    </section>
  </main>

  <footer class="hh-footer"><span>© 2025 HashHero</span></footer>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const statusEl = document.getElementById('status');
    function setStatus(msg){ if(statusEl) statusEl.textContent = msg || ''; }
    const $ = (id) => document.getElementById(id);

    const canvas = $('c');
    const ctx = canvas.getContext('2d');
    const fileInput = $('file');
    const templatesEl = $('templates');
    const addTextBtn = $('addText');
    const textList = $('textList');
    const resetBtn = $('resetPositions');
    const upperCb = $('upper');
    const fontSizeRange = $('fontSize');
    const outlineRange = $('outline');
    const alignSel = $('align');
    const wmCb = $('wm');
    const wmText = $('watermarkText');
    const clearTemplateBtn = $('clearTemplate');
    const tabBuiltIn = $('tabBuiltIn');
    const tabTrending = $('tabTrending');
    const tplSearch = $('tplSearch');

    // State
    let img = null, texts = [], activeId = null, activeTab = 'built', trendingTemplates = [];

    // Built-in templates
    const TEMPLATES = [
      { name: 'Top/Bottom (classic)', data: makeSolidTemplate('#222', 1000, 1000) },
      { name: 'Two Panel', data: makeTwoPanelTemplate(1000, 1000) },
      { name: 'Four Panel', data: makeFourPanelTemplate(1000, 1000) }
    ];

    function makeSolidTemplate(color, w, h) {
      const cnv = document.createElement('canvas'); cnv.width = w; cnv.height = h;
      const c2 = cnv.getContext('2d'); c2.fillStyle = color; c2.fillRect(0,0,w,h);
      return cnv.toDataURL('image/png');
    }
    function makeTwoPanelTemplate(w, h) {
      const cnv = document.createElement('canvas'); cnv.width = w; cnv.height = h;
      const c2 = cnv.getContext('2d');
      c2.fillStyle = '#111'; c2.fillRect(0,0,w,h);
      c2.fillStyle = '#333'; c2.fillRect(0,0,w,h/2);
      c2.strokeStyle='rgba(255,255,255,0.2)'; c2.lineWidth=4; c2.strokeRect(2,2,w-4,h-4);
      return cnv.toDataURL('image/png');
    }
    function makeFourPanelTemplate(w, h) {
      const cnv = document.createElement('canvas'); cnv.width = w; cnv.height = h;
      const c2 = cnv.getContext('2d');
      c2.fillStyle = '#111'; c2.fillRect(0,0,w,h);
      c2.fillStyle = '#2a2a2a'; c2.fillRect(0,0,w/2,h/2);
      c2.fillStyle = '#3a3a3a'; c2.fillRect(w/2,0,w/2,h/2);
      c2.fillStyle = '#2f2a2a'; c2.fillRect(0,h/2,w/2,h/2);
      c2.fillStyle = '#383838'; c2.fillRect(w/2,h/2,w/2,h/2);
      c2.strokeStyle='rgba(255,255,255,0.2)'; c2.lineWidth=4; c2.strokeRect(2,2,w-4,h-4);
      return cnv.toDataURL('image/png');
    }

    function renderTemplatesBuilt() {
      templatesEl.innerHTML = TEMPLATES.map((t,i)=>`
        <div class="template" data-built="${i}" title="${t.name}">
          <img src="${t.data}" alt="${t.name}" data-built="${i}">
        </div>`).join('');
      templatesEl.querySelectorAll('[data-built]').forEach(el => {
        el.addEventListener('click', () => {
          const t = TEMPLATES[+el.getAttribute('data-built')];
          loadImage(t.data);
        }, { passive: true });
      });
    }

    async function fetchTrending() {
      try {
        const res = await fetch('https://api.imgflip.com/get_memes', { mode: 'cors', cache: 'no-store' });
        const data = await res.json();
        if (data?.success && Array.isArray(data.data?.memes)) {
          trendingTemplates = data.data.memes.filter(m => m.box_count <= 4).slice(0, 60);
        } else {
          setStatus('Could not load trending templates.');
        }
      } catch (e) {
        setStatus('Trending templates blocked by network. Use Built-in or Upload.');
      }
    }

    function renderTemplatesTrending() {
      const q = (tplSearch.value || '').toLowerCase().trim();
      let arr = trendingTemplates;
      if (q) arr = arr.filter(m => m.name.toLowerCase().includes(q));
      if (!arr.length) {
        templatesEl.innerHTML = '<div class="small muted">No templates found. Try a different search.</div>';
        return;
      }
      templatesEl.innerHTML = arr.map(m => `
        <div class="template" data-url="${encodeURIComponent(m.url)}" title="${m.name}">
          <img src="${m.url}" alt="${m.name}" data-url="${encodeURIComponent(m.url)}">
        </div>`).join('');

      templatesEl.querySelectorAll('.template, .template img').forEach(el => {
        el.addEventListener('click', async (e) => {
          const encoded = e.target.getAttribute('data-url') || e.currentTarget.getAttribute('data-url');
          if (!encoded) return;
          const url = decodeURIComponent(encoded);
          const blobUrl = await safeLoadToBlobUrl(url);
          if (blobUrl) loadImage(blobUrl, true);
          else loadImage(url);
        }, { passive: true });
      });
    }

    async function safeLoadToBlobUrl(url) {
      try {
        const res = await fetch(url, { mode: 'cors' });
        if (!res.ok) return null;
        const blob = await res.blob();
        return URL.createObjectURL(blob);
      } catch { return null; }
    }

    function setTab(tab) {
      activeTab = tab;
      if (tab === 'built') renderTemplatesBuilt();
      else {
        if (!trendingTemplates.length) { fetchTrending().then(renderTemplatesTrending); }
        else { renderTemplatesTrending(); }
      }
    }

    function addTextBox(initial='NEW TEXT', y=80) {
      const id = Math.random().toString(36).slice(2,9);
      texts.push({ id, x: canvas.width/2, y, text: initial, size: +fontSizeRange.value, align: alignSel.value });
      activeId = id;
      renderTextList();
      draw();
    }

    function renderTextList() {
      textList.innerHTML = texts.map(t => `
        <div class="card" style="margin-top:8px;">
          <div style="display:flex; justify-content:space-between; align-items:center; gap:10px;">
            <div class="small muted">Text box</div>
            <button class="pill small" data-del="${t.id}">Delete</button>
          </div>
          <div style="margin-top:8px;">
            <input type="text" data-id="${t.id}" value="${t.text.replace(/"/g,'&quot;')}" style="width:100%;">
          </div>
        </div>`).join('');
      textList.querySelectorAll('[data-del]').forEach(btn => btn.addEventListener('click', () => {
        const id = btn.getAttribute('data-del');
        texts = texts.filter(x => x.id !== id);
        if (activeId === id) activeId = texts[0]?.id || null;
        renderTextList(); draw();
      }));
      textList.querySelectorAll('input[type="text"]').forEach(inp => {
        inp.addEventListener('input', () => {
          const id = inp.getAttribute('data-id');
          const t = texts.find(x => x.id === id);
          if (!t) return;
          t.text = inp.value;
          draw();
        });
        inp.addEventListener('focus', () => activeId = inp.getAttribute('data-id'));
      });
    }

    function fontSpec(size){ return `${size}px Impact, 'Anton', 'Arial Black', system-ui, sans-serif`; }
    function formatText(line){ return upperCb.checked ? (line || '').toUpperCase() : (line || ''); }

    function draw() {
      ctx.fillStyle = '#000'; ctx.fillRect(0,0,canvas.width, canvas.height);
      if (img) ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
      else {
        const g = ctx.createLinearGradient(0,0,canvas.width, canvas.height);
        g.addColorStop(0,'#20243e'); g.addColorStop(1,'#10131f');
        ctx.fillStyle = g; ctx.fillRect(0,0,canvas.width, canvas.height);
        ctx.fillStyle = 'rgba(255,255,255,0.2)'; ctx.textAlign='center'; ctx.font='22px system-ui, sans-serif';
        ctx.fillText('Upload an image or pick a template', canvas.width/2, canvas.height/2);
      }
      const outline = +outlineRange.value;
      texts.forEach(t => {
        ctx.font = fontSpec(t.size); ctx.textAlign = t.align; ctx.textBaseline = 'middle';
        const lines = (t.text || '').split('\n'); const lh = t.size * 1.2;
        lines.forEach((line, idx) => {
          const yy = t.y + (idx - (lines.length-1)/2) * lh; const txt = formatText(line);
          if (outline > 0) { ctx.lineWidth = outline; ctx.strokeStyle = '#000'; ctx.strokeText(txt, t.x, yy); }
          ctx.fillStyle = '#fff'; ctx.fillText(txt, t.x, yy);
        });
      });
      if (wmCb.checked && wmText.value.trim()) {
        const s = Math.max(12, Math.round(canvas.width * 0.03));
        ctx.save(); ctx.globalAlpha = 0.65;
        ctx.font = `bold ${s}px system-ui, sans-serif`; ctx.fillStyle = 'rgba(255,255,255,0.6)';
        ctx.textAlign = 'right'; ctx.textBaseline = 'bottom';
        ctx.fillText(wmText.value.trim(), canvas.width - 14, canvas.height - 14);
        ctx.restore();
      }
    }

    function measureTextBox(t) {
      ctx.font = fontSpec(t.size);
      const lines = (t.text || '').split('\n');
      const widths = lines.map(line => ctx.measureText(formatText(line)).width);
      const w = Math.max(...widths, 1) + 20;
      const lineHeight = t.size * 1.2;
      const h = lines.length * lineHeight + 20;
      let x = t.x, left = 0;
      if (t.align === 'center') left = x - w/2;
      if (t.align === 'left') left = x;
      if (t.align === 'right') left = x - w;
      return { left, top: t.y - h/2, w, h, lineHeight, lines };
    }

    function hitTest(mx, my) {
      for (let i = texts.length -1; i >= 0; i--) {
        const t = texts[i];
        const box = measureTextBox(t);
        if (mx >= box.left && mx <= box.left + box.w && my >= box.top && my <= box.top + box.h) return t;
      }
      return null;
    }

    // Dragging
    let dragging = false, dragOffsetX = 0, dragOffsetY = 0;
    canvas.addEventListener('mousedown', startDrag);
    canvas.addEventListener('touchstart', (e) => startDrag(e.touches[0]));
    window.addEventListener('mousemove', moveDrag);
    window.addEventListener('touchmove', (e) => moveDrag(e.touches[0]));
    window.addEventListener('mouseup', endDrag);
    window.addEventListener('touchend', endDrag);

    function startDrag(e) {
      const r = canvas.getBoundingClientRect();
      const x = (e.clientX - r.left) * (canvas.width / r.width);
      const y = (e.clientY - r.top) * (canvas.height / r.height);
      const t = hitTest(x,y);
      if (t) { dragging = true; activeId = t.id; dragOffsetX = x - t.x; dragOffsetY = y - t.y; e.preventDefault(); }
    }
    function moveDrag(e) {
      if (!dragging) return;
      const r = canvas.getBoundingClientRect();
      const x = (e.clientX - r.left) * (canvas.width / r.width);
      const y = (e.clientY - r.top) * (canvas.height / r.height);
      const t = texts.find(x => x.id === activeId);
      if (t) { t.x = x - dragOffsetX; t.y = y - dragOffsetY; draw(); }
    }
    function endDrag(){ dragging = false; }

    // Controls
    addTextBtn.addEventListener('click', () => addTextBox('NEW TEXT'));
    resetBtn.addEventListener('click', () => { texts.forEach((t,i)=>{ t.x=canvas.width/2; t.y=i===0?80:canvas.height-80; }); draw(); });
    upperCb.addEventListener('change', draw);
    fontSizeRange.addEventListener('input', ()=>{ (activeId? [texts.find(x=>x.id===activeId)] : texts).forEach(t=> t && (t.size=+fontSizeRange.value)); draw(); });
    outlineRange.addEventListener('input', draw);
    alignSel.addEventListener('change', ()=>{ (activeId? [texts.find(x=>x.id===activeId)] : texts).forEach(t=> t && (t.align=alignSel.value)); draw(); });
    wmCb.addEventListener('change', draw);
    wmText.addEventListener('input', draw);

    // File upload
    fileInput.addEventListener('change', (e) => {
      const f = e.target.files?.[0];
      if (!f) { setStatus('No file selected.'); return; }
      const url = URL.createObjectURL(f);
      loadImage(url, true);
    });

    function loadImage(src, revoke=false) {
      setStatus('');
      const image = new Image();
      image.crossOrigin = 'anonymous';
      image.onload = () => {
        img = image;
        let w = image.width, h = image.height, max=1000;
        if (w > h) { if (w > max) { h = Math.round(h * (max / w)); w = max; } }
        else { if (h > max) { w = Math.round(w * (max / h)); h = max; } }
        canvas.width = w; canvas.height = h;
        if (!texts.length){ addTextBox('TOP TEXT'); addTextBox('BOTTOM TEXT', canvas.height - 120); }
        else { texts[0].y = 80; texts[texts.length-1].y = canvas.height - 80; }
        draw();
        if (revoke) setTimeout(()=>URL.revokeObjectURL(src), 1000);
      };
      image.onerror = () => setStatus('Could not load image. If this was a remote template, tap “Open” then download and upload.');
      image.src = src;
    }

    // Tabs
    tabBuiltIn.addEventListener('click', () => setTab('built'));
    tabTrending.addEventListener('click', () => setTab('trend'));
    tplSearch.addEventListener('input', () => { if (activeTab==='trend') renderTemplatesTrending(); });
    clearTemplateBtn.addEventListener('click', () => { img = null; draw(); });

    // Defaults
    addTextBox('TOP TEXT');
    addTextBox('BOTTOM TEXT', canvas.height - 120);
    setTab('built');
    draw();

    // Download buttons (first is the PNG button with class .btn)
    document.querySelector('.btn').addEventListener('click', () => download('image/png'));
    $('downloadJpg').addEventListener('click', () => download('image/jpeg'));
    function download(type='image/png') {
      const link = document.createElement('a');
      link.download = 'hashhero-meme' + (type === 'image/png' ? '.png' : '.jpg');
      link.href = canvas.toDataURL(type, type === 'image/jpeg' ? 0.92 : undefined);
      link.click();
    }
  });
  </script>
</body>
</html>
